{
  "Rules": [
    {
      "Name": "documentdb-failover-events",
      "Description": "Detectar eventos de failover do DocumentDB",
      "EventPattern": {
        "source": ["aws.rds"],
        "detail-type": ["RDS DB Instance Event"],
        "detail": {
          "EventCategories": ["failover"]
        }
      },
      "State": "ENABLED",
      "Targets": [
        {
          "Id": "1",
          "Arn": "arn:aws:sns:us-east-1:ACCOUNT_ID:documentdb-alerts",
          "InputTransformer": {
            "InputPathsMap": {
              "instance": "$.detail.SourceArn",
              "message": "$.detail.Message",
              "time": "$.time"
            },
            "InputTemplate": "\"üîÑ FAILOVER DETECTADO\\n\\nInst√¢ncia: <instance>\\nMensagem: <message>\\nHor√°rio: <time>\\n\\nA√ß√£o: Verifique o status do cluster e confirme que as aplica√ß√µes reconectaram.\""
          }
        }
      ]
    },
    {
      "Name": "documentdb-backup-events",
      "Description": "Monitorar eventos de backup do DocumentDB",
      "EventPattern": {
        "source": ["aws.rds"],
        "detail-type": ["RDS DB Cluster Snapshot Event"],
        "detail": {
          "EventCategories": ["backup"]
        }
      },
      "State": "ENABLED",
      "Targets": [
        {
          "Id": "1",
          "Arn": "arn:aws:sns:us-east-1:ACCOUNT_ID:documentdb-alerts",
          "InputTransformer": {
            "InputPathsMap": {
              "cluster": "$.detail.SourceIdentifier",
              "message": "$.detail.Message",
              "time": "$.time"
            },
            "InputTemplate": "\"üíæ EVENTO DE BACKUP\\n\\nCluster: <cluster>\\nMensagem: <message>\\nHor√°rio: <time>\""
          }
        }
      ]
    },
    {
      "Name": "documentdb-maintenance-events",
      "Description": "Alertas de manuten√ß√£o programada",
      "EventPattern": {
        "source": ["aws.rds"],
        "detail-type": ["RDS DB Instance Event"],
        "detail": {
          "EventCategories": ["maintenance"]
        }
      },
      "State": "ENABLED",
      "Targets": [
        {
          "Id": "1",
          "Arn": "arn:aws:sns:us-east-1:ACCOUNT_ID:documentdb-alerts",
          "InputTransformer": {
            "InputPathsMap": {
              "instance": "$.detail.SourceIdentifier",
              "message": "$.detail.Message",
              "time": "$.time"
            },
            "InputTemplate": "\"üîß MANUTEN√á√ÉO PROGRAMADA\\n\\nInst√¢ncia: <instance>\\nMensagem: <message>\\nHor√°rio: <time>\\n\\nPrepare-se para poss√≠vel indisponibilidade tempor√°ria.\""
          }
        }
      ]
    },
    {
      "Name": "documentdb-availability-events",
      "Description": "Eventos de disponibilidade do cluster",
      "EventPattern": {
        "source": ["aws.rds"],
        "detail-type": ["RDS DB Instance Event"],
        "detail": {
          "EventCategories": ["availability"]
        }
      },
      "State": "ENABLED",
      "Targets": [
        {
          "Id": "1",
          "Arn": "arn:aws:sns:us-east-1:ACCOUNT_ID:documentdb-alerts",
          "InputTransformer": {
            "InputPathsMap": {
              "instance": "$.detail.SourceIdentifier",
              "message": "$.detail.Message",
              "time": "$.time"
            },
            "InputTemplate": "\"‚ö†Ô∏è EVENTO DE DISPONIBILIDADE\\n\\nInst√¢ncia: <instance>\\nMensagem: <message>\\nHor√°rio: <time>\""
          }
        }
      ]
    },
    {
      "Name": "documentdb-configuration-change",
      "Description": "Mudan√ßas de configura√ß√£o do cluster",
      "EventPattern": {
        "source": ["aws.rds"],
        "detail-type": ["RDS DB Cluster Event", "RDS DB Instance Event"],
        "detail": {
          "EventCategories": ["configuration change"]
        }
      },
      "State": "ENABLED",
      "Targets": [
        {
          "Id": "1",
          "Arn": "arn:aws:sns:us-east-1:ACCOUNT_ID:documentdb-alerts",
          "InputTransformer": {
            "InputPathsMap": {
              "resource": "$.detail.SourceIdentifier",
              "message": "$.detail.Message",
              "time": "$.time"
            },
            "InputTemplate": "\"‚öôÔ∏è MUDAN√áA DE CONFIGURA√á√ÉO\\n\\nRecurso: <resource>\\nMensagem: <message>\\nHor√°rio: <time>\""
          }
        }
      ]
    },
    {
      "Name": "documentdb-security-events",
      "Description": "Eventos de seguran√ßa e acesso",
      "EventPattern": {
        "source": ["aws.rds"],
        "detail-type": ["RDS DB Instance Event", "RDS DB Cluster Event"],
        "detail": {
          "EventCategories": ["security"]
        }
      },
      "State": "ENABLED",
      "Targets": [
        {
          "Id": "1",
          "Arn": "arn:aws:sns:us-east-1:ACCOUNT_ID:documentdb-alerts",
          "InputTransformer": {
            "InputPathsMap": {
              "resource": "$.detail.SourceIdentifier",
              "message": "$.detail.Message",
              "time": "$.time"
            },
            "InputTemplate": "\"üîí EVENTO DE SEGURAN√áA\\n\\nRecurso: <resource>\\nMensagem: <message>\\nHor√°rio: <time>\\n\\n‚ö†Ô∏è Revise imediatamente este evento de seguran√ßa.\""
          }
        }
      ]
    },
    {
      "Name": "documentdb-deletion-events",
      "Description": "Alertas de dele√ß√£o de recursos",
      "EventPattern": {
        "source": ["aws.rds"],
        "detail-type": ["RDS DB Instance Event", "RDS DB Cluster Event"],
        "detail": {
          "EventCategories": ["deletion"]
        }
      },
      "State": "ENABLED",
      "Targets": [
        {
          "Id": "1",
          "Arn": "arn:aws:sns:us-east-1:ACCOUNT_ID:documentdb-alerts",
          "InputTransformer": {
            "InputPathsMap": {
              "resource": "$.detail.SourceIdentifier",
              "message": "$.detail.Message",
              "time": "$.time"
            },
            "InputTemplate": "\"üóëÔ∏è RECURSO DELETADO\\n\\nRecurso: <resource>\\nMensagem: <message>\\nHor√°rio: <time>\\n\\n‚ö†Ô∏è CR√çTICO: Um recurso do DocumentDB foi deletado!\""
          }
        }
      ]
    }
  ],
  "Instructions": {
    "Setup": [
      "1. Substitua ACCOUNT_ID pelo ID da sua conta AWS",
      "2. Crie o t√≥pico SNS primeiro: aws sns create-topic --name documentdb-alerts",
      "3. Confirme a subscription de email",
      "4. Aplique as regras usando os comandos abaixo"
    ],
    "ApplyRules": {
      "Failover": "aws events put-rule --name documentdb-failover-events --description 'Detectar eventos de failover' --event-pattern file://patterns/failover-pattern.json && aws events put-targets --rule documentdb-failover-events --targets file://targets/sns-target.json",
      "Backup": "aws events put-rule --name documentdb-backup-events --description 'Monitorar backups' --event-pattern file://patterns/backup-pattern.json && aws events put-targets --rule documentdb-backup-events --targets file://targets/sns-target.json",
      "Maintenance": "aws events put-rule --name documentdb-maintenance-events --description 'Alertas de manuten√ß√£o' --event-pattern file://patterns/maintenance-pattern.json && aws events put-targets --rule documentdb-maintenance-events --targets file://targets/sns-target.json"
    },
    "TestRule": "aws events put-events --entries '[{\"Source\":\"aws.rds\",\"DetailType\":\"RDS DB Instance Event\",\"Detail\":\"{\\\"EventCategories\\\":[\\\"failover\\\"],\\\"SourceArn\\\":\\\"test-instance\\\",\\\"Message\\\":\\\"Test message\\\"}\"}]'",
    "ListRules": "aws events list-rules --name-prefix documentdb-",
    "DescribeRule": "aws events describe-rule --name documentdb-failover-events",
    "DeleteRule": "aws events remove-targets --rule documentdb-failover-events --ids 1 && aws events delete-rule --name documentdb-failover-events"
  },
  "EventCategories": {
    "availability": "Eventos relacionados √† disponibilidade da inst√¢ncia",
    "backup": "Eventos de backup e snapshot",
    "configuration change": "Mudan√ßas de configura√ß√£o",
    "creation": "Cria√ß√£o de recursos",
    "deletion": "Dele√ß√£o de recursos",
    "failover": "Eventos de failover",
    "failure": "Falhas do sistema",
    "low storage": "Armazenamento baixo",
    "maintenance": "Manuten√ß√£o programada",
    "notification": "Notifica√ß√µes gerais",
    "recovery": "Recupera√ß√£o de falhas",
    "restoration": "Restaura√ß√£o de backups",
    "security": "Eventos de seguran√ßa"
  },
  "BestPractices": [
    "Configure m√∫ltiplas targets para regras cr√≠ticas (SNS + Lambda + CloudWatch Logs)",
    "Use Input Transformers para formatar mensagens de forma leg√≠vel",
    "Teste regras regularmente com put-events",
    "Monitore m√©tricas de entrega do EventBridge",
    "Configure DLQ (Dead Letter Queue) para targets que podem falhar",
    "Use tags para organizar regras por ambiente/criticidade",
    "Documente runbooks para cada tipo de evento",
    "Configure filtros espec√≠ficos para reduzir ru√≠do"
  ]
}
